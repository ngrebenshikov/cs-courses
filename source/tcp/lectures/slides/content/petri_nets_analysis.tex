Хакасский государственный университет им. Н.Ф. Катанова\newline
Теория вычислительных процессов\newline
\title{Лекция: Анализ сетей Петри.}
\date{}
\author{Николай Гребенщиков, www.grebenshikov.ru}
\maketitle

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Анализ сетей Петри}
	
	Моделирование без анализа малополезно!
	
	Задача анализа сети Петри - определение свойств сети:
	
	$\spot$ Безопасность\newline
	$\spot$ Ограниченность\newline
	$\spot$ Сохранение\newline
	$\spot$ Активность\newline
	$\spot$ Достижимость и покрываемость\newline
	$\spot$ Эквивалентность
	
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства сети Петри: \textbf{Безопасность}
	
	Позиция $p_i \in P$ сети Петри $C=(P, T, I, O)$ c начальной маркировкой $\mu$ является безопасной, если $\mu^{'}(p_i) \leq 1$ для любой $\mu^{'} \in R(C,\mu)$.
	
	Сеть безопасна, если каждая позиция в ней безопасна.
	
	Безопасность важна для моделирования аппаратуры. Безопасную позицию можно реализовать одним триггером.
		
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
Свойства сети Петри: \textbf{Безопасность}
	\begin{center}
		\includegraphics[height=0.85\textheight]{content/petri_nets/analysis_security.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства сети Петри: \textbf{Ограниченность}
	
	Позиция $p_i \in P$ сети Петри $C=(P, T, I, O)$ c начальной маркировкой $\mu$ является $k$-ограниченной, если $\mu^{'}(p_i) \leq k$ для любой $\mu^{'} \in R(C,\mu)$.
	
	$k$-ограниченные позиции реализуются в виде счетчиков.
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства сети Петри: \textbf{Сохранение}
	
	Сеть Петри $C=(P, T, I, O)$ c начальной маркировкой $\mu$ является \textit{строго сохраняющей}, если для всех $\mu^{'} \in R(C,\mu)$
	
\begin{center}
$\displaystyle\sum_{p_i \in P}{\mu^{'}(p_i)}=\sum_{p_i \in P}{\mu(p_i)}$
\end{center}
	
	Свойство сохранения является важным при моделировании распределения ресурсов.
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства сети Петри: \textbf{Сохранение}
	\begin{center}
		\includegraphics[height=0.85\textheight]{content/petri_nets/analysis_saving_no.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства сети Петри: \textbf{Сохранение}
	\begin{center}
		\includegraphics[height=0.85\textheight]{content/petri_nets/analysis_saving_yes.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства сети Петри: \textbf{Сохранение}
	
	Сеть Петри $C=(P, T, I, O)$ c начальной маркировкой $\mu$ является \textit{сохраняющей} по отношению к вектору взвешивания $w, w=(w_1, w_2, \ldots, w_n), n=|P|, w_i \geq 0$, если для всех $\mu^{'} \in R(C,\mu)$
	
\begin{center}
$\displaystyle\sum_{i}{w_i \cdot \mu^{'}(p_i)}=\sum_{i}{w_i \cdot \mu(p_i)}$
\end{center}
	
	Строго сохраняющая сеть является сохраняющей относительно вектора $(1,1,\ldots,1)$
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Активность}. Моделирование ресурсов.
	\begin{center}
		\includegraphics[height=0.85\textheight]{content/petri_nets/analysis_saving_res.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Активность}.
	
	Переход $t_j$ называется активным (потенциально запустимым) при маркировке $\mu$, если существует маркировка $\mu^{'} \in R(C, \mu)$, в которой $t_j$ разрешен.
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Активность}. Уровни авктивности перехода $t_j$.

	Уровень 0: $t_j$ никогда не может быть запущен.
	
	Уровень 1: $t_j$ потенциально запустим.
	
	Уровень 2: Если для всякого целого $n$ существует последовательность запусков, в которой $t_j$ присутствует не менее $n$ раз.
	
	Уровень 3: Существует бесконечноая поледовательность запусков, в которой $t_j$ присутствует неограниченно часто.
	
	Уровень 4: Если для всякой $\mu^{'} \in R(C, \mu)$ существует такая последовательность запусков $\sigma$, что $t_j$ разрешен в $\delta(\mu^{'}, \sigma)$
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Активность}. Уровни активности.
	\begin{center}
		\includegraphics[height=0.65\textheight]{content/petri_nets/analysis_active.png}	
	\end{center}
	
	$t_0$ - уровень 0 (пассивен); $t_1$ - уровень 1; $t_2$ - уровень 2 (зависит от $t_3$); $t_3$ - уровень 3 (нельзя запустить после $t_1$).
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Достижимость и покрываемость}.
	
	\textit{Задача достижимости:} Для заданной сети Петри $C$ с маркировкой $\mu$ и маркировки $\mu^{'}$ определить: $\mu^{'} \in R(C,\mu)$
		
	\textit{Задача покрываемости:} Для заданной сети Петри $C$ с маркировкой $\mu$ и маркировки $\mu^{'}$ определить существует ли такая достижимая маркировка $\mu^{''} \in R(C, \mu)$, что $\mu^{''} \geq \mu^{'}$:
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Покрываемость}. Взаимное исключение.
	\begin{center}
		\includegraphics[height=0.85\textheight]{content/petri_nets/analysis_coverable.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	Свойства: \textbf{Эквивалентность}
	
	Требования оптимизации.
	
	Избавление от пассивных переходов и позиций, без изменения поведения.
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Методы анализа}

	\begin{itemize}
		\item Деревья достижимости
		\item Матричные уравнения
	\end{itemize}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Дерево достижимости}
		\begin{center}
		\includegraphics[width=1\textwidth]{content/petri_nets/analysis_reachability.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Дерево достижимости}
		\begin{center}
		\includegraphics[width=0.8\textwidth]{content/petri_nets/analysis_reachability1.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Дерево достижимости}
		\begin{center}
		\includegraphics[width=0.7\textwidth]{content/petri_nets/analysis_reachability2.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Бесконечное дерево достижимости}
		\begin{center}
		\includegraphics[width=0.5\textwidth]{content/petri_nets/analysis_reachability_infinity.png}	
	\end{center}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Построение дерева достижимости}
	
	Если существует последовательность $\delta$ переходов, которая приводит к маркировке $\mu^{'}, \mu^{'} > \mu$, то  цикл.
	
	Бесконечное число маркировок такого цикла - $\omega, \newline a + \omega = \omega, \omega - a = \omega, a < \omega, \omega \leq \omega$
	
	Вершины дерева: граничные, внутренние, дублирующие, терминальные. 
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Алгоритм построения дерева достижимости}
	
	Начало: начальная маркировка - граничная вершина.
	
	Пока есть в дереве граничные вершины выполнять следующие шаги.
	
	Пусть $x$ - обрабатываемая граничная вершина.
	
	1. $\exists y$ - неграничная, $\mu[x]=\mu[y] \Rightarrow x - $ дублирующая. 
	
	2. $\delta(\mu[x], t_j) - $ неопределена $\forall t_j \in T \Rightarrow x -$ терминальная.
\end{slide}
	
% ----------------------------------------------------------------
\begin{slide}
	\textbf{Алгоритм построения дерева достижимости}

	3. $\forall t_j \in T, \delta(\mu[x], t_j)$ - определена, создать новую вершину $z$.
	
	а) $\mu[x] = \omega \Rightarrow \mu[z] = \omega$
	
	б) Если на пути от корня до $x$ существует $y, \mu[y] < \delta(\mu[x],t_j)$ и $\mu[y]_i < \delta(\mu[x],t_j)_i$, то $\mu[z]_i = \omega$.
	
	в) В противном случае $\mu[z]_i = \delta(\mu[x], t_j)_i$
	
	$x$ - помечается как внутренняя вершина, а $z$ как граничная.
\end{slide}
	
% ----------------------------------------------------------------
\begin{slide}
	\textbf{Построение дерева достижимости}
	
	\begin{center}
		\includegraphics[width=0.7\textwidth]{content/petri_nets/analysis_reachability_ex.png}	
	\end{center}
\end{slide}
	
% ----------------------------------------------------------------
\begin{slide}
	\textbf{Построение дерева достижимости}
	
	\begin{center}
		\includegraphics[width=0.4\textwidth]{content/petri_nets/analysis_reachability_ex1.png}	
	\end{center}
\end{slide}
	
% ----------------------------------------------------------------
\begin{slide}
	\textbf{Проверка свойств}: безопасность и ограниченность.
	
	\textit{Сеть Петри ограниченна тогда и только тогда, когда символ $\omega$ отсутствует в её дереве достижимости.}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Проверка свойств}: сохранение.
	
	\textit{Сеть Петри является сохраняющей для некоторого вектора, если взвешенные суммы маркировок всех узлов в дереве равны.}
	
	При неизвестном векторе весов получаем систему линейных уравнений. Для каждой $\mu[x]$ в дереве
	
	$w_1 \cdot \mu[x]_1 + w_2 \cdot \mu[x]_2 + \ldots + w_n \cdot \mu[x]_n = s$
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Проверка свойств}: покрываемость.
	
	Для проверки достижима ли маркировка $m^{''} \geq \mu^{'}$ необходимо постройть дерево достижимости для начальной маркировки $\mu$.
	
\begin{itemize}
	\item $\exists x, \mu[x] \geq \mu^{'} \Rightarrow \mu[x]$ дает покрывающую $\mu^{'}$ маркировку.
	\item Иначе не существует достижимой покрывающей маркировки. 
\end{itemize}
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Ограниченность метода анализа с помощью деревьев достижимости}
	
	Данный метод не подходит для решения задачь достижимости и активности.
	
	Проблема в $\omega$ - потеря информации.
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
	\textbf{Метод анализа с помощью матричных уравнений}

	Оставляем для реферата.	
\end{slide}

% ----------------------------------------------------------------
\begin{slide}
\textbf{Список литературы}
\begin{itemize}
	\item Питерсон, Дж., Теория сете Петри и моделирование систем - М.: Мир, 1984. - \textbf{сc.79-113}
	\item Котов, В.Е., Сети Петри. - М.: Наука, 1984.
\end{itemize}
\end{slide}